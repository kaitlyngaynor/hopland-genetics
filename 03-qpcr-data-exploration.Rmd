---
title: "Data visualization and exploration - QPCR data"
author: "Kaitlyn"
date: "2019-04-11"
output: md_document
editor_options:
  chunk_output_type: console
---

Set working directory and load data.

```{r setup, message = F, warning = F}
library(here)
library(tidyverse)

# import cleaned data file
genotypes <- read_csv(here::here("data", "cleaned-triplicates-genotypes-qpcr.csv"))
```

## qPCR by storage method
```{r concentration by storage}
ggplot(genotypes, aes(x = stor, y = extracted_conc, fill = stor)) +
  geom_boxplot() +
  ylab("DNA Concentration") +
  xlab("Storage Method") +
  ggtitle("DNA Concentration Across Storage Methods")

ggplot(genotypes, aes(x = stor, y = log(extracted_conc), fill = stor)) +
  geom_boxplot() +
  ylab("DNA Concentration (log)") +
  xlab("Storage Method") +
  ggtitle("DNA Concentration Across Storage Methods")

ggplot(genotypes, aes(x = extracted_conc)) +
  geom_histogram() +
  facet_grid(stor ~ .)

ggplot(genotypes, aes(x = log(extracted_conc))) +
  geom_histogram() +
  facet_grid(stor ~ .)

ggplot(genotypes, aes(x = log(extracted_conc))) +
  geom_density() +
  facet_grid(stor ~ .)

```

#### FIG qpcr-density-storage.pdf
```{r export density diagram}
pdf(here::here("figures", "qpcr-density-storage.pdf"), width = 5, height = 3)
ggplot(genotypes, aes(x = log(extracted_conc), col = stor)) +
  geom_density() +
  xlab("Extracted Concentration (log)") +
  ylab("Density")
dev.off()
```


Calculate some summary stats
```{r summary stats}
qpcr.summary <- genotypes %>%
  group_by(stor) %>%
  summarize(mean = mean(extracted_conc, na.rm = TRUE),
            median = median(extracted_conc, na.rm = TRUE),
            sd = sd(extracted_conc, na.rm = TRUE),
            min = min(extracted_conc, na.rm = TRUE),
            max = max(extracted_conc, na.rm = TRUE)
            )

qpcr.summary
```

Quick ANOVA to see if there is a difference in DNA concentration across storage methods (there isn't).

```{r anova comparison}
fit <- aov(extracted_conc ~ stor, data = genotypes)
summary(fit)

# try as two-way anova
fit <- aov(extracted_conc ~ stor + Error(lab_id/stor), data = genotypes)
summary(fit)
```


## Relationship between genotyping and qPCR

Here, plotting the number of amplifying genotypes vs. DNA concentration (qPCR). It doesn't look like there is much of a relationship, even though we might expect a positive relationship.
```{r genotyping vs qpcr}
ggplot(genotypes, aes(log(extracted_conc), n, col = stor)) +
  geom_jitter()
```

Relationship between concentration and complete/working samples across storage methods
```{r concentration and complete or working}
# working
ggplot(genotypes, aes(x = log(extracted_conc), col = working)) +
  geom_density() +
  facet_grid(stor~.) +
  xlab("Extracted Concentration (log)") +
  ylab("Density")

# complete
ggplot(genotypes, aes(x = log(extracted_conc), col = perfect)) +
  geom_density() +
  facet_grid(stor~.) +
  xlab("Extracted Concentration (log)") +
  ylab("Density")
```

#### FIG qpcr-density-complete-storage.pdf
```{r export density diagram}
pdf(here::here("figures", "qpcr-density-working-storage.pdf"), width = 5, height = 5)
ggplot(genotypes, aes(x = log(extracted_conc), col = working)) +
  geom_density() +
  facet_grid(stor~.) +
  xlab("Extracted Concentration (log)") +
  ylab("Density")
dev.off()
```


## qPCR vs condition, by storage method
```{r concentration by storage * condition}
ggplot(genotypes, aes(x = cond, y = log(extracted_conc), col = stor)) +
  geom_jitter() +
  facet_wrap(~ stor) +
  ylab("DNA Concentration (log)") +
  xlab("Sample Condition") 
```

Quick ANOVA to see if there is a difference in DNA concentration in samples with usable vs not usable genotypes for each of the three storage methods.

```{r anova comparison}
genotypes.dry.work <- subset(genotypes, stor == "dry" & working == "yes")
genotypes.dry.workno <- subset(genotypes, stor == "dry" & working == "no")
t.test(genotypes.dry.work$extracted_conc, genotypes.dry.workno$extracted_conc)

genotypes.EtOH.work <- subset(genotypes, stor == "EtOH" & working == "yes")
genotypes.EtOH.workno <- subset(genotypes, stor == "EtOH" & working == "no")
t.test(genotypes.EtOH.work$extracted_conc, genotypes.EtOH.workno$extracted_conc)

genotypes.swab.work <- subset(genotypes, stor == "swab" & working == "yes")
genotypes.swab.workno <- subset(genotypes, stor == "swab" & working == "no")
t.test(genotypes.swab.work$extracted_conc, genotypes.swab.workno$extracted_conc)
```

